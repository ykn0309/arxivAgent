<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>arxivAgent - 智能论文推荐工具</title>
    <!-- Inter字体 - 现代科技感字体 -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <!-- 导航栏 -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-brand">
                <h1>arxivAgent</h1>
                <span class="nav-subtitle">智能论文推荐助手</span>
            </div>
            <div class="nav-menu">
                <button class="nav-btn active" data-tab="recommendation">推荐</button>
                <button class="nav-btn" data-tab="list">列表</button>
                <button class="nav-btn" data-tab="settings">设置</button>
                <div class="nav-progress" id="nav-progress">
                    <span class="nav-progress-text">未读:</span>
                    <span class="nav-progress-count" id="recommendation-remaining">—</span>
                    <span class="nav-progress-text" style="margin-left:10px">正在处理:</span>
                    <span class="nav-progress-count" id="recommendation-processing">—</span>
                </div>
            </div>
        </div>
    </nav>

    <main class="main-content">
        <!-- 推荐页面 -->
        <section id="recommendation-tab" class="tab-content active">
            <div class="recommendation-container">
                <div class="paper-card">
                    <div id="card-loading" class="card-loading" style="display:flex;align-items:center;justify-content:center;padding:40px;">
                    <div class="loading-spinner" style="width:40px;height:40px;border:4px solid #eee;border-top-color:#6b5bff;border-radius:50%;animation:spin 1s linear infinite;"></div>
                    </div>

                    <div id="card-content" class="card-content" style="display:none;padding:24px;">
                    <h2 id="paper-title" class="paper-title"></h2>
                    <h3 id="paper-chinese-title" class="paper-chinese-title" style="display:none;color:#666;font-weight:600;"></h3>
                    <div class="paper-detail-meta" style="margin:8px 0;color:#777;">
                        <span id="paper-published-date"></span>
                        <span id="paper-authors" style="margin-left:12px;"></span>
                    </div>
                    <div id="paper-categories" style="margin-bottom:12px;"></div>

                    <div class="paper-recommendation-reason" style="margin:12px 0;">
                        <h3>推荐理由</h3>
                        <p id="paper-recommendation-reason"></p>
                    </div>

                    <div class="paper-abstract">
                        <h3>Abstract</h3>
                        <p id="paper-abstract"></p>
                    </div>

                    <div class="paper-chinese-abstract" style="margin-top:12px;">
                        <h3>中文摘要</h3>
                        <p id="paper-chinese-abstract"></p>
                    </div>

                    <div class="paper-actions" style="margin:18px 0;display:flex;gap:12px;">
                        <button class="action-btn dislike-btn" data-action="dislike">👎 不喜欢</button>
                        <button class="action-btn maybe-btn" data-action="maybe_later">⏰ 稍后再说</button>
                        <button class="action-btn like-btn" data-action="favorite">👍 喜欢</button>
                    </div>

                    <div class="paper-links" style="margin-top:6px;">
                        <a href="#" class="paper-link" id="paper-arxiv-link" target="_blank">查看原文</a>
                        <a href="#" class="paper-link" id="paper-pdf-link" target="_blank" style="margin-left:12px;">下载PDF</a>
                    </div>
                    </div>

                    <div class="card-empty" id="card-empty" style="display: none;padding:24px;text-align:center;">
                    <div class="empty-icon" style="font-size:48px;margin-bottom:8px;">📚</div>
                    <h3>暂无推荐论文</h3>
                    <p>可能是以下原因：</p>
                    <ul style="list-style:disc;margin-left:20px;text-align:left;display:inline-block;text-align:left;">
                        <li>还没有配置好基本设置</li>
                        <li>需要等待系统爬取更多论文</li>
                        <li>所有论文都已评估完毕</li>
                    </ul>
                    <div style="margin-top:12px;"><button class="primary-btn" id="refresh-recommendation">刷新试试</button></div>
                    </div>
                </div>
            </div>
        </section>

        <!-- 列表页面 -->
        <section id="list-tab" class="tab-content">
            <div class="list-container">
                <div class="list-tabs">
                    <button class="list-tab-btn" data-list="favorites">收藏列表</button>
                    <button class="list-tab-btn" data-list="maybe-later">稍后再说</button>
                    <button class="list-tab-btn" data-list="library">论文库</button>
                </div>

                <!-- 收藏列表 -->
                <div id="favorites-list" class="list-content">
                    <div class="list-header">
                        <h2>收藏的论文</h2>
                        <div class="pagination-controls" id="favorites-pagination"></div>
                    </div>
                    <div class="papers-list" id="favorites-papers-list"></div>
                </div>

                <!-- 程序化管理的论文库（所有论文） -->
                <div id="library-list" class="list-content">
                    <!-- 管理面板：论文管理操作（抓取、删除未评估、标记已评估未处理为不喜欢等） -->
                    <div class="admin-panel" id="admin-panel">
                        <h3>论文管理</h3>
                        <div class="admin-controls">
                            <div class="control-row">
                                <label>上次抓取时间: </label>
                                <div class="last-crawl-display" id="admin-last-crawl-date">--</div>
                                <button type="button" id="admin-crawl-now" class="warning-btn" style="margin-left:12px">抓取最新论文</button>
                            </div>
                            <div class="control-row">
                                <button type="button" id="admin-delete-unprocessed" class="danger-btn" title="删除未被评估且未被用户标记的论文">清理未处理论文</button>
                                <button type="button" id="admin-delete-others" class="danger-btn" title="删除除了收藏和稍后再说之外的所有论文">清理其他论文</button>
                            </div>
                            <div class="control-row">
                                <button type="button" id="admin-mark-unread-read" class="warning-btn" title="将所有未读论文标记为已读">标记未读为已读</button>
                            </div>
                            <div class="control-row">
                                <label for="admin-filter-status">筛选状态:</label>
                                <select id="admin-filter-status">
                                    <option value="all">全部</option>
                                    <option value="unassessed">未评估</option>
                                    <option value="assessed">已评估</option>
                                    <option value="unread">未读</option>
                                    <option value="favorite">喜欢</option>
                                    <option value="disliked">不喜欢</option>
                                    <option value="maybe_later">稍后再说</option>
                                </select>
                                <button type="button" id="admin-refresh-list" class="primary-btn">刷新列表</button>
                            </div>
                        </div>
                    </div>

                    <!-- 管理列表：显示所有论文并支持批量操作 -->
                    <div class="admin-list" id="admin-list">
                        <div class="admin-actions">
                            <input type="checkbox" id="admin-select-all"> 全选
                            <button type="button" id="admin-bulk-favorite" class="secondary-btn">批量标记喜欢</button>
                            <button type="button" id="admin-bulk-maybe" class="secondary-btn">批量标记稍后再说</button>
                            <button type="button" id="admin-bulk-dislike" class="secondary-btn">批量标记不喜欢</button>
                            <button type="button" id="admin-bulk-delete" class="danger-btn">批量删除</button>
                        </div>
                        <div class="papers-table" id="admin-papers-table">
                            <!-- 列表由 JS 渲染 -->
                        </div>
                    </div>
                </div>
                
                <!-- 稍后再说列表 -->
                <div id="maybe-later-list" class="list-content">
                    <div class="list-header">
                        <h2>稍后再说的论文</h2>
                        <div class="pagination-controls" id="maybe-later-pagination"></div>
                    </div>
                    <div class="papers-list" id="maybe-later-papers-list"></div>
                </div>
            </div>
        </section>

        <!-- 设置页面 -->
        <section id="settings-tab" class="tab-content">
            <div class="settings-container">
                <div class="settings-header">
                    <h1>系统设置</h1>
                    <p>配置您的个性化推荐体验</p>
                </div>
                
                <div class="settings-sections">
                    <!-- 配置状态概览 -->
                    <div class="settings-section">
                        <h2>📋 配置状态</h2>
                        <div class="config-status" id="config-status">
                            <div class="status-item">
                                <span class="status-label">LLM配置:</span>
                                <span class="status-value" id="llm-status">未配置</span>
                            </div>
                            <div class="status-item">
                                <span class="status-label">研究兴趣:</span>
                                <span class="status-value" id="interests-status">未配置</span>
                            </div>
                            <div class="status-item">
                                <span class="status-label">关注分类:</span>
                                <span class="status-value" id="categories-status">未配置</span>
                            </div>
                        </div>
                    </div>

                    <!-- LLM配置 -->
                    <div class="settings-section">
                        <h2>🤖 LLM配置</h2>
                        <form id="llm-config-form" class="config-form">
                            <div class="form-group">
                                <label for="llm-base-url">API基础URL:</label>
                                <input type="url" id="llm-base-url" placeholder="https://api.openai.com/v1" required>
                            </div>
                            <div class="form-group">
                                <label for="llm-api-key">API密钥:</label>
                                <input type="password" id="llm-api-key" placeholder="sk-..." required>
                            </div>
                            <div class="form-group">
                                <label for="llm-model">模型:</label>
                                <input type="text" id="llm-model" placeholder="例如: gpt-3.5-turbo" required>
                                <small class="form-help">请输入模型名称，如 gpt-3.5-turbo, gpt-4, claude-3-haiku 等</small>
                            </div>
                            <div class="form-actions">
                                <button type="submit" class="primary-btn">保存配置</button>
                                <button type="button" id="test-llm-btn" class="secondary-btn">测试连接</button>
                            </div>
                        </form>
                    </div>

                    <!-- 研究兴趣配置 -->
                    <div class="settings-section">
                        <h2>🎯 研究兴趣</h2>
                        <form id="interests-form" class="config-form">
                            <div class="form-group">
                                <label for="user-interests">请描述您的研究方向或感兴趣的技术领域:</label>
                                <textarea id="user-interests" rows="4" placeholder="例如：我主要从事机器学习和自然语言处理方面的研究，特别关注大语言模型、对话系统和文本生成技术..."></textarea>
                            </div>
                            <div class="form-group">
                                <label>精炼后的兴趣点:</label>
                                <div class="refined-interests" id="refined-interests">
                                    <p class="placeholder-text">保存后将显示精炼结果</p>
                                </div>
                            </div>
                            <div class="form-actions">
                                <button type="submit" class="primary-btn">保存并精炼</button>
                            </div>
                        </form>
                    </div>

                    <!-- 分类配置 -->
                    <div class="settings-section">
                        <h2>📂 关注分类</h2>
                        <form id="categories-form" class="config-form">
                            <div class="form-group">
                                <label>请选择您关注的arXiv计算机科学子分区:</label>
                                <div class="categories-list" id="categories-list">
                                    <!-- 分类选项将通过JavaScript动态生成 -->
                                </div>
                            </div>
                            <div class="form-actions">
                                <button type="submit" class="primary-btn">保存分类</button>
                            </div>
                        </form>
                    </div>

                    <!-- 收藏总结 -->
                    <div class="settings-section">
                        <h2>📊 收藏总结</h2>
                        <div class="config-form">
                            <div class="form-group">
                                <label>基于收藏论文总结出的研究兴趣:</label>
                                <textarea id="favorite-summary" rows="4" placeholder="系统会根据您的收藏自动总结..."></textarea>
                            </div>
                            <div class="form-actions">
                                <button type="button" id="update-summary-btn" class="primary-btn">更新总结</button>
                                <button type="button" id="save-summary-btn" class="secondary-btn">手动保存</button>
                            </div>
                        </div>
                    </div>

                    <!-- 系统维护已移至“论文库”管理面板 -->
                </div>
            </div>
        </section>
    </main>

    <!-- 论文详情模态框 -->
    <div class="modal" id="paper-detail-modal">
        <div class="modal-content paper-detail-modal-content">
            <button class="modal-close" id="paper-detail-close">&times;</button>
            
            <div class="paper-detail-header">
                <h2 class="paper-detail-title" id="paper-detail-title"></h2>
                <h3 class="paper-detail-chinese-title" id="paper-detail-chinese-title"></h3>
                <div class="paper-detail-categories" id="paper-detail-categories"></div>
                <div class="paper-detail-meta">
                    <span class="paper-detail-date" id="paper-detail-published-date"></span>
                </div>
            </div>
            
            <div class="paper-detail-authors" id="paper-detail-authors"></div>
            
            <div class="paper-detail-recommendation-reason">
                <h3>推荐理由</h3>
                <p id="paper-detail-recommendation-reason"></p>
            </div>
            
            <div class="paper-detail-abstract">
                <h3>Abstract</h3>
                <p id="paper-detail-abstract"></p>
            </div>
            
            <div class="paper-detail-chinese-abstract">
                <h3>中文摘要</h3>
                <p id="paper-detail-chinese-abstract"></p>
            </div>
            
            <div class="paper-detail-links">
                <a href="#" class="paper-link" id="paper-detail-arxiv-link" target="_blank">查看原文</a>
                <a href="#" class="paper-link" id="paper-detail-pdf-link" target="_blank">下载PDF</a>
            </div>
        </div>
    </div>

    <!-- 用户笔记模态框 已移除 -->

    <!-- 加载遮罩 -->
    <div class="loading-overlay" id="loading-overlay" style="display: none;">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <p id="loading-message">处理中...</p>
        </div>
    </div>

    <script src="{{ url_for('static', filename='js/api.js') }}"></script>
    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
</body>
</html>